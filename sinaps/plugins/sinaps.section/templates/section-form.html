{% extends "sinaps.admin/_frame.html" %}

{% set title = 'Sections' %}
{% set subtitle = '' %}
{% set breadcrumbs = [{
	href: '/admin/sections/',
	title: 'Sections'
},{
	href: '/admin/sections/~edit/' + section.name,
	title: 'Edit ' + section.name
}] %}

{% import 'sinaps.admin/components/schema.html' as schemaForm %}
{% import 'sinaps.admin/components/fields.html' as fields %}

{% block content %}

	<form class="" action="index.html" method="post">
		<div class="row">
			<div class="col-md-9">
				<div class="portlet light">
					<div class="portlet-body form">
						<div class="form-body">
							{# {{ schemaForm.form(schema.getLayout(section.layout)) }} #}

							{{ fields.textField({
								name: 'name',
								label: 'Name',
								instructions: 'Used as a reference key.',
								value: section.name,
								required: true
							}) }}

							{{ fields.textField({
								name: 'title',
								label: 'Title',
								instructions: 'Only used as the title in the administration panel.',
								value: section.title,
								required: true
							}) }}

							{% for lang in sinaps.config.languages %}
								{{ fields.textField({
									name: 'url.' + lang,
									label: 'URL (' + lang|upper + ')',
									instructions: '(Optional) Nunjucks syntax allowed.',
									value: section.get('url.' + lang)
								}) }}
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="portlet light">
					<div class="portlet-body form">
						<div class="form-body">
							{{ schemaForm.langSwitcher() }}

							{{ schemaForm.layoutSwitcher(schema) }}

						</div>
						<div class="form-actions">
							<div class="row">
								<div class="col-md-offset-3 col-md-9">
									<button type="submit" class="btn btn-sm green">
										<i class="fa fa-check"></i>
										Save
									</button>
									<button type="reset" class="btn btn-sm default">Cancel</button>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<div class="row">
			<div class="col-md-9">

				<div id="newlayout" class="modal fade" tabindex="-1" role="basic" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								<h4 class="modal-title">New layout</h4>
							</div>
							<div class="modal-body">
								{{ fields.textField({
									name: 'name',
									label: 'Name',
									instructions: 'Used as a reference key.',
									required: true
								}) }}
								{{ fields.textField({
									name: 'title',
									label: 'Title',
									instructions: 'Only used as the title in the administration panel.',
									required: true
								}) }}
							</div>
							<div class="modal-footer">
								<button role="reset" type="button" class="btn default" data-dismiss="modal">Cancel</button>
								<button role="save" type="button" class="btn blue" data-dismiss="modal">
									<i class="fa fa-plus"></i>
									Add
								</button>
							</div>
						</div>
					</div>
				</div><!-- newlayout -->

				<div id="newtab" class="modal fade" tabindex="-1" role="basic" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								<h4 class="modal-title">New tab</h4>
							</div>
							<div class="modal-body">
								{{ fields.textField({
									name: 'name',
									label: 'Name',
									instructions: 'Used as a reference key.',
									required: true
								}) }}
								{{ fields.textField({
									name: 'title',
									label: 'Title',
									instructions: 'Only used as the title in the administration panel.',
									required: true
								}) }}
							</div>
							<div class="modal-footer">
								<button role="reset" type="button" class="btn default" data-dismiss="modal">Cancel</button>
								<button role="save" type="button" class="btn blue" data-dismiss="modal">
									<i class="fa fa-plus"></i>
									Add
								</button>
							</div>
						</div>
					</div>
				</div><!-- newtab -->

				<div class="portlet light">
					<div class="portlet-title">
						<div class="caption">
							Layouts &amp; Tabs &amp; Fields
						</div>
						<div class="actions">
							<a role="create-layout" class="btn default btn-sm blue" data-toggle="modal" href="#newlayout">
								<i class="fa fa-plus"></i>
								New layout
							</a>
						</div>
					</div>
					<div class="portlet-body">
						<div class="tabbable-line" role="tab-layout">
							<ul class="nav nav-tabs">

							</ul>
							<div class="tab-content">

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>

{% endblock %}

{% block footJS %}
	{% raw %}
		<script type="text/x-template" name="layout">
			<div class="col-xs-3">
				<ul class="nav nav-tabs tabs-left">
					{% for tab in tabs %}
						<li>
							<a href="#tab-tab-{{ name }}" data-toggle="tab" {% if loop.first %}class="active"{% endif %}>
								{{ title }}
							</a>
						</li>
					{% endfor %}
				</ul>
				<a role="create-layout" class="btn default btn-sm blue" data-toggle="modal" href="#newtab">
					<i class="fa fa-plus"></i>
					New tab
				</a>
			</div>
			<div class="col-xs-9">
				<div class="tab-content">
					{% for tab in tabs %}
						<div id="tab-tab-{{ name }}" class="tab-pane">
							BLeh !
						</div>
					{% endfor %}
				</div>
			</div>
		</script>
	{% endraw %}
	<script>
		$(function () {

			var $layouts = $('[role="tab-layout"]').first(),
				$layoutTabs = $layouts.find('.nav-tabs').first(),
				$layoutContents = $layouts.find('.tab-content').first(),
				$newLayoutBtn = $('[role="create-layout"]').first(),
				$newLayoutModal = $('[id="newlayout"]').first();

			function createLayout (name, title, tabs) {

				var id = 'tab-layout-' + name;
				$layoutTabs.append('<li><a href="#' + id + '" data-toggle="tab">' + title + '</a></li>');
				$layoutContents.append('<div id="' + id + '" class="tab-pane">'+id+'</div>');

				$layoutTabs.find('[data-toggle="tab"]').last().click();
			}

			$newLayoutModal.find('[role="reset"]').on('click', function (e) {
				$newLayoutModal.find(':input').val('');
			});

			$newLayoutModal.find('[role="save"]').on('click', function (e) {
				var name = $newLayoutModal.find('[name="name"]').val();
				var title = $newLayoutModal.find('[name="title"]').val();
				$newLayoutModal.find(':input').val('');
				createLayout(name, title, []);
			});

		});
	</script>
{% endblock %}
