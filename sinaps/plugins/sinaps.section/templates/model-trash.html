{% extends "sinaps.admin/_frame.html" %}

{% import 'sinaps.admin/components/fields.html' as fields %}

{% set title = 'Sections' %}
{% set subtitle = '' %}
{% set breadcrumbs = [{
	href: '/admin/sections/',
	title: 'Sections'
},{
	href: '/admin/sections/' + section.schema.handle + '/',
	title: section.schema.label
},{
	href: '/admin/sections/' + section.schema.handle + '/trash',
	title: 'Trash'
}] %}

{% set page = 0 %}
{% set perpage = 50 %}
{% set offset = page * perpage %}

{% macro pagination (page, offset, perpage, total) %}
	{% set pmin = max(page - 5, 0) %}
	{% set pmax = min(page + 5, floor(total / perpage)) %}
	{% set querystr = "" %}
	<div class="row">
		<div class="col-md-12">
			<nav>
				<ul class="pagination">
					<li {% if page <= 0 %}class="disabled"{% endif %}>
						<a href="?page=0&min={{ options.min }}{{ querystr }}">&laquo;</a>
					</li>
					<li {% if page - 1 < 0 %}class="disabled"{% endif %}>
						<a href="?page={{ max(page - 1, 0) }}{{ querystr }}">&lsaquo;</a>
					</li>
					{% for p in range(pmin, pmax) %}
						<li {% if p == page %}class="active"{% endif %}>
							<a href="?page={{ p }}{{ querystr }}">{{ p + 1 }}</a>
						</li>
					{% endfor %}
					<li {% if page + 1 > floor(total / perpage) %}class="disabled"{% endif %}>
						<a href="?page={{ min(page + 1, floor(total / perpage)) }}{{ querystr }}">&rsaquo;</a>
					</li>
					<li {% if page >= floor(total / perpage) %}class="disabled"{% endif %}>
						<a href="?page={{ floor(total / perpage) }}{{ querystr }}">&raquo;</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
{% endmacro %}

{% block content %}

	<div class="portlet light">
		<div class="portlet-title">
			<div class="caption">
				{{ section.schema.label }}
				<span class="caption-helper">{{ "stuff you threw away" }}</span>
			</div>
			<div class="actions">
			</div>
		</div>
		<div class="portlet-body">
			{{ pagination(page * perpage, offset, perpage, count) }}

			<table class="table table-hover">
				<thead>
					<tr>
						<th width="1"></th>
						{% for path, column in columns %}
							<th>{{ column.label }}</th>
						{% endfor %}
						<th width="1"></th>
					</tr>
				</thead>
				<tbody>
					{% for entry in entries %}
						<tr>
							<td><input type="checkbox" name="id[]" value="{{ entry.id }}" /></td>
							{% for path, column in columns %}
								<td>
									{% if column.lang %}
										{% set value = l10n(entry.get(path))|default('...') %}
									{% else %}
										{% set value = entry.get(path)|default('...') %}
									{% endif %}
									{{ fields.value({
										type: column.input,
										value: value
									}) }}
								</td>
							{% endfor %}
							<td class="text-no-wrap">
								<a href="/admin/sections/{{ section.schema.handle }}/restore/{{ entry.id }}" class="btn btn-sm" role="restore">
									{{ "Restore" }}
								</a>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>

			{{ pagination(page * perpage, offset, perpage, count) }}
		</div>
	</div>


{% endblock %}

{% block footJS %}
	<script>
		$(function () {

			// Show confirm dialog on delete
			$('a[role="restore"]').on('click', function (e) {
				e.preventDefault();
				var $a = $(this);

				bootbox.dialog({
					message: 'Are you sure you want to restore this entry?',
					title: 'Restore entry',
					buttons: {
						cancel: {
							className: 'btn-default',
							label: 'Cancel'
						},
						delete: {
							className: 'blue',
							label: 'Restore',
							callback: function () {
								window.location = $a.attr('href');
							}
						}
					}
				});
			});

		});
	</script>
{% endblock %}
