{% extends "sinaps.admin/_frame.html" %}

{% set title = 'Sections' %}
{% set subtitle = '' %}
{% set breadcrumbs = [{
	href: '/admin/sections/',
	title: 'Sections'
},{
	href: '/admin/sections/' + handle + '/',
	title: section.schema.label
},{
	href: '/admin/sections/' + handle + '/edit/' + model.id,
	title: l10n(model.getTitle())|default(model.id)
}] %}

{% block actions %}
<div class="btn-group">
	<button type="submit" class="btn btn-primary" form="main">
		{% if _action == 'edit' %}
			<i class="fa fa-check"></i>
			{{ "Save" }}
		{% else %}
			<i class="fa fa-plus"></i>
			{{ "Create" }}
		{% endif %}
	</button>
</div>
{% endblock %}

{% import 'sinaps.admin/components/fields.html' as fields %}
{% import 'sinaps.admin/components/schema.html' as schema %}

{% block content %}

	<form id="main" method="post">
		<div class="row">
			<div class="col-xs-12 col-lg-8">
				<div class="portlet light">
					<main>

						{{ schema.tabs(section.schema, model) }}

					</main>
				</div>
			</div>
			<div class="col-xs-12 col-lg-4">
				<div class="portlet light">
					<main>
						{% set languages = [] %}
						{% for lang in sinaps.config.languages %}
							{% set languages = languages|merge({
								value: lang,
								label: lang|upper
							}) %}
						{% endfor %}

						{{ fields.field({
							type: 'selectbox',
							id: 'language',
							name: '',
							value: sinaps.config.languages[0],
							label: 'Language',
							options: languages,
							required: true
						}) }}

						{% set layouts = [] %}
						{% for layout in section.schema.layouts %}
							{% set layouts = layouts|merge({
								value: layout.handle,
								label: layout.label|default(layout.name)
							}) %}
						{% endfor %}

						{{ fields.field({
							type: 'selectbox',
							id: 'layout',
							name: 'layout',
							value: model.layout,
							label: 'Layout',
							options: layouts,
							required: true
						}) }}

						{{ fields.field({
							type: 'datetime',
							name: 'postDate',
							value: model.postDate,
							label: 'Post date'
						}) }}

						{{ fields.field({
							type: 'datetime',
							name: 'expireDate',
							value: model.expireDate,
							label: 'Expire date'
						}) }}
					</main>
				</div>
			</div>
		</div>
	</form>

{% endblock %}

{% block footJS %}
	<script type="text/javascript">
		$(function () {

			if (window.location.hash) {
				var lang = window.location.hash.replace(/^#/, '');
				if ($('#language [value="'+ lang +'"]').length) {
					$('#language').val(lang);
				}
			}

			$('#language').on('change', function (e) {
				var lang = $(this).val();
				$('[data-lang]').hide().filter('[data-lang="'+ lang +'"]').show();
				window.location.hash = lang;
			}).trigger('change');

			$('#layout').on('change', function (e) {
				var layout = $(this).val();
				window.location.search = '?layout=' + layout;
			});

		});
	</script>
{% endblock %}
